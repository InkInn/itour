{"version":3,"file":"fileupload.js","sourceRoot":"","sources":["fileupload.ts"],"names":[],"mappings":"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","sourcesContent":["import {NgModule,Component,OnInit,Input,Output,EventEmitter,TemplateRef,AfterContentInit,ContentChildren,QueryList} from '@angular/core';\nimport {CommonModule} from '@angular/common';\nimport {DomSanitizer} from '@angular/platform-browser';\nimport {ButtonModule} from '../button/button';\nimport {MessagesModule} from '../messages/messages';\nimport {ProgressBarModule} from '../progressbar/progressbar';\nimport {Message} from '../common/api';\nimport {PrimeTemplate,SharedModule} from '../common/shared';\n\n@Component({\n    selector: 'p-fileUpload',\n    template: `\n        <div [ngClass]=\"'ui-fileupload ui-widget'\" [ngStyle]=\"style\" [class]=\"styleClass\">\n            <div class=\"ui-fileupload-buttonbar ui-widget-header ui-corner-top\">\n                <button type=\"button\" [label]=\"chooseLabel\" icon=\"fa-plus\" pButton class=\"ui-fileupload-choose\" (click)=\"onChooseClick($event, fileinput)\" [disabled]=\"disabled\"> \n                    <input #fileinput type=\"file\" (change)=\"onFileSelect($event)\" [multiple]=\"multiple\" [accept]=\"accept\" [disabled]=\"disabled\">\n                </button>\n\n                <button *ngIf=\"!auto\" type=\"button\" [label]=\"uploadLabel\" icon=\"fa-upload\" pButton (click)=\"upload()\" [disabled]=\"!hasFiles()\"></button>\n                <button *ngIf=\"!auto\" type=\"button\" [label]=\"cancelLabel\" icon=\"fa-close\" pButton (click)=\"clear()\" [disabled]=\"!hasFiles()\"></button>\n            \n                <p-templateLoader [template]=\"toolbarTemplate\"></p-templateLoader>\n            </div>\n            <div [ngClass]=\"{'ui-fileupload-content ui-widget-content ui-corner-bottom':true,'ui-fileupload-highlight':dragHighlight}\" \n                (dragenter)=\"onDragEnter($event)\" (dragover)=\"onDragOver($event)\" (dragleave)=\"onDragLeave($event)\" (drop)=\"onDrop($event)\">\n                <p-progressBar [value]=\"progress\" [showValue]=\"false\" *ngIf=\"hasFiles()\"></p-progressBar>\n                \n                <p-messages [value]=\"msgs\"></p-messages>\n                \n                <div class=\"ui-fileupload-files\" *ngIf=\"hasFiles()\">\n                    <div *ngIf=\"!fileTemplate\">\n                        <div class=\"ui-fileupload-row\" *ngFor=\"let file of files; let i = index;\">\n                            <div><img [src]=\"file.objectURL\" *ngIf=\"isImage(file)\" [width]=\"previewWidth\" /></div>\n                            <div>{{file.name}}</div>\n                            <div>{{formatSize(file.size)}}</div>\n                            <div><button type=\"button\" icon=\"fa-close\" pButton (click)=\"remove(i)\"></button></div>\n                        </div>\n                    </div>\n                    <div *ngIf=\"fileTemplate\">\n                        <template ngFor [ngForOf]=\"files\" [ngForTemplate]=\"fileTemplate\"></template>\n                    </div>\n                </div>\n                \n                <p-templateLoader [template]=\"contentTemplate\"></p-templateLoader>\n            </div>\n        </div>\n    `\n})\nexport class FileUpload implements OnInit,AfterContentInit {\n    \n    @Input() name: string;\n    \n    @Input() url: string;\n    \n    @Input() multiple: boolean;\n    \n    @Input() accept: string;\n    \n    @Input() disabled: boolean;\n    \n    @Input() auto: boolean;\n        \n    @Input() maxFileSize: number;\n    \n    @Input() invalidFileSizeMessageSummary: string = '{0}: Invalid file size, ';\n    \n    @Input() invalidFileSizeMessageDetail: string = 'maximum upload size is {0}.';\n    \n    @Input() style: string;\n    \n    @Input() styleClass: string;\n    \n    @Input() previewWidth: number = 50;\n    \n    @Input() chooseLabel: string = 'Choose';\n    \n    @Input() uploadLabel: string = 'Upload';\n    \n    @Input() cancelLabel: string = 'Cancel';\n        \n    @Output() onBeforeUpload: EventEmitter<any> = new EventEmitter();\n\t\n\t@Output() onBeforeSend: EventEmitter<any> = new EventEmitter();\n        \n    @Output() onUpload: EventEmitter<any> = new EventEmitter();\n    \n    @Output() onError: EventEmitter<any> = new EventEmitter();\n    \n    @Output() onClear: EventEmitter<any> = new EventEmitter();\n    \n    @Output() onSelect: EventEmitter<any> = new EventEmitter();\n    \n    @ContentChildren(PrimeTemplate) templates: QueryList<any>;\n     \n    public files: File[];\n    \n    public progress: number = 0;\n    \n    public dragHighlight: boolean;\n    \n    public msgs: Message[];\n    \n    public fileTemplate: TemplateRef<any>;\n    \n    public contentTemplate: TemplateRef<any>; \n    \n    public toolbarTemplate: TemplateRef<any>; \n        \n    constructor(private sanitizer: DomSanitizer){}\n    \n    ngOnInit() {\n        this.files = [];\n    }\n    \n    ngAfterContentInit():void {\n        this.templates.forEach((item) => {\n            switch(item.getType()) {\n                case 'file':\n                    this.fileTemplate = item.template;\n                break;\n                \n                case 'content':\n                    this.contentTemplate = item.template;\n                break;\n                \n                case 'toolbar':\n                    this.toolbarTemplate = item.template;\n                break;\n                \n                default:\n                    this.fileTemplate = item.template;\n                break;\n            }\n        });\n    }\n    \n    onChooseClick(event, fileInput) {\n        fileInput.value = null;\n        fileInput.click();\n    }\n    \n    onFileSelect(event) {\n        this.msgs = [];\n        if(!this.multiple) {\n            this.files = [];\n        }\n        \n        let files = event.dataTransfer ? event.dataTransfer.files : event.target.files;\n        for(let i = 0; i < files.length; i++) {\n            let file = files[i];\n            if(this.validate(file)) {\n                if(this.isImage(file)) {\n                    file.objectURL = this.sanitizer.bypassSecurityTrustUrl((window.URL.createObjectURL(files[i])));\n                }\n                \n                this.files.push(files[i]);\n            }\n        }\n        \n        this.onSelect.emit({originalEvent: event, files: files});\n        \n        if(this.hasFiles() && this.auto) {\n            this.upload();\n        }\n    }\n    \n    validate(file: File): boolean {\n        if(this.maxFileSize  && file.size > this.maxFileSize) {\n            this.msgs.push({\n                severity: 'error', \n                summary: this.invalidFileSizeMessageSummary.replace('{0}', file.name), \n                detail: this.invalidFileSizeMessageDetail.replace('{0}', this.formatSize(this.maxFileSize))\n            });\n            return false;\n        }\n        \n        return true;\n    }\n    \n    isImage(file: File): boolean {\n        return /^image\\//.test(file.type);\n    }\n    \n    onImageLoad(img: any) {\n        window.URL.revokeObjectURL(img.src);\n    }\n\n    upload() {\n        this.msgs = [];\n        let xhr = new XMLHttpRequest(),\n        formData = new FormData();\n\n\t\tthis.onBeforeUpload.emit({\n            'xhr': xhr,\n            'formData': formData \n        });\n\n        for(let i = 0; i < this.files.length; i++) {\n            formData.append(this.name, this.files[i], this.files[i].name);\n        }\n\n        xhr.upload.addEventListener('progress', (e: ProgressEvent) => {\n            if(e.lengthComputable) {\n              this.progress = Math.round((e.loaded * 100) / e.total);\n            }\n          }, false);\n\n        xhr.onreadystatechange = () => {\n            if(xhr.readyState == 4) {\n                this.progress = 0;\n                \n                if(xhr.status >= 200 && xhr.status < 300)\n                    this.onUpload.emit({xhr: xhr, files: this.files});\n                else\n                    this.onError.emit({xhr: xhr, files: this.files});\n                \n                this.clear();\n            }\n        };\n        \n        xhr.open('POST', this.url, true);\n\t\t\n\t\tthis.onBeforeSend.emit({\n\t\t\t'xhr': xhr,\n            'formData': formData \n\t\t});\n        \n        xhr.send(formData);\n    }\n\n    clear() {\n        this.files = [];\n        this.onClear.emit();\n    }\n    \n    remove(index: number) {\n        this.files.splice(index, 1);\n    }\n    \n    hasFiles(): boolean {\n        return this.files && this.files.length > 0;\n    }\n    \n    onDragEnter(e) {\n        if(!this.disabled) {\n            e.stopPropagation();\n            e.preventDefault();\n        }\n    }\n    \n    onDragOver(e) {\n        if(!this.disabled) {\n            this.dragHighlight = true;\n            e.stopPropagation();\n            e.preventDefault();\n        }\n    }\n    \n    onDragLeave(e) {\n        if(!this.disabled) {\n            this.dragHighlight = false;\n        }\n    }\n    \n    onDrop(e) {\n        if(!this.disabled) {\n            this.dragHighlight = false;\n            e.stopPropagation();\n            e.preventDefault();\n            \n            this.onFileSelect(e);\n        }\n    }\n    \n    formatSize(bytes) {\n        if(bytes == 0) {\n            return '0 B';\n        }\n        let k = 1000,\n        dm = 3,\n        sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'],\n        i = Math.floor(Math.log(bytes) / Math.log(k));\n        \n        return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n    }\n}\n\n@NgModule({\n    imports: [CommonModule,SharedModule,ButtonModule,ProgressBarModule,MessagesModule],\n    exports: [FileUpload,SharedModule,ButtonModule,ProgressBarModule,MessagesModule],\n    declarations: [FileUpload]\n})\nexport class FileUploadModule { }"]}