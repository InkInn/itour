{"version":3,"file":"datascroller.js","sourceRoot":"","sources":["datascroller.ts"],"names":[],"mappings":"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","sourcesContent":["import {NgModule,Component,ElementRef,AfterViewInit,AfterContentInit,OnDestroy,DoCheck,Input,Output,Renderer,ViewChild,EventEmitter,ContentChild,ContentChildren,QueryList,IterableDiffers,TemplateRef} from '@angular/core';\nimport {CommonModule} from '@angular/common';\nimport {Header,Footer,PrimeTemplate,SharedModule} from '../common/shared';\nimport {DomHandler} from '../dom/domhandler';\n\n@Component({\n    selector: 'p-dataScroller',\n    template: `\n    <div [ngClass]=\"{'ui-datascroller ui-widget': true, 'ui-datascroller-inline': inline}\" [ngStyle]=\"style\" [class]=\"styleClass\">\n        <div class=\"ui-datascroller-header ui-widget-header ui-corner-top\" *ngIf=\"header\">\n            <ng-content select=\"p-header\"></ng-content>\n        </div>\n        <div #content class=\"ui-datascroller-content ui-widget-content\" [ngStyle]=\"{'max-height': scrollHeight}\">\n            <ul class=\"ui-datascroller-list\">\n                <li *ngFor=\"let item of dataToRender\">\n                    <template [pTemplateWrapper]=\"itemTemplate\" [item]=\"item\"></template>\n                </li>\n            </ul>\n        </div>\n        <div class=\"ui-datascroller-footer ui-widget-header ui-corner-bottom\" *ngIf=\"footer\">\n            <ng-content select=\"p-footer\"></ng-content>\n        </div>\n    </div>\n    `,\n    providers: [DomHandler]\n})\nexport class DataScroller implements AfterViewInit,DoCheck,OnDestroy {\n\n    @Input() value: any[];\n\n    @Input() rows: number;\n\n    @Input() lazy: boolean;\n    \n    @Output() onLazyLoad: EventEmitter<any> = new EventEmitter();\n\n    @Input() style: any;\n\n    @Input() styleClass: string;\n    \n    @Input() buffer: number = 0.9;\n    \n    @Input() inline: boolean;\n    \n    @Input() scrollHeight: any;\n    \n    @Input() loader: any;\n    \n    @ViewChild('content') contentViewChild: ElementRef;\n        \n    @ContentChild(Header) header;\n\n    @ContentChild(Footer) footer;\n    \n    @ContentChildren(PrimeTemplate) templates: QueryList<any>;\n    \n    public itemTemplate: TemplateRef<any>;\n\n    public dataToRender: any[] = [];\n\n    public first: number = 0;\n    \n    differ: any;\n    \n    scrollFunction: any;\n    \n    contentElement: HTMLDivElement;\n\n    constructor(public el: ElementRef, differs: IterableDiffers, public renderer: Renderer, public domHandler: DomHandler) {\n        this.differ = differs.find([]).create(null);\n    }\n\n    ngAfterViewInit() {\n        if(this.lazy) {\n            this.load();\n        }\n        \n        if(this.loader) {\n            this.scrollFunction = this.renderer.listen(this.loader, 'click', () => {\n                this.load();\n            });\n        }\n        else {\n            this.bindScrollListener();\n        }\n    }\n    \n    ngAfterContentInit() {\n        this.templates.forEach((item) => {\n            switch(item.getType()) {\n                case 'item':\n                    this.itemTemplate = item.template;\n                break;\n                \n                default:\n                    this.itemTemplate = item.template;\n                break;\n            }\n        });\n    }\n    \n    ngDoCheck() {\n        let changes = this.differ.diff(this.value);\n\n        if(changes) {\n            if(this.lazy)\n                this.dataToRender = this.value;\n            else\n                this.load();\n        }\n    }\n    \n    load() {\n        if(this.lazy) {\n            this.onLazyLoad.emit({\n                first: this.first,\n                rows: this.rows\n            });\n        }\n        else {\n            for(let i = this.first; i < (this.first + this.rows); i++) {\n                if(i >= this.value.length) {\n                    break;\n                }\n\n                this.dataToRender.push(this.value[i]);\n            }\n        }\n        this.first = this.first + this.rows;\n    }\n     \n    reset() {\n        this.first = 0;\n        this.dataToRender = [];\n        this.load();\n    }\n\n    isEmpty() {\n        return !this.dataToRender||(this.dataToRender.length == 0);\n    }\n    \n    createLazyLoadMetadata(): any {\n        return {\n            first: this.first,\n            rows: this.rows\n        };\n    }\n    \n    bindScrollListener() {\n        if(this.inline) {\n            this.contentElement = this.contentViewChild.nativeElement;\n            \n            this.scrollFunction = this.renderer.listen(this.contentElement, 'scroll', () => {\n                let scrollTop = this.contentElement.scrollTop;\n                let scrollHeight = this.contentElement.scrollHeight;\n                let viewportHeight = this.contentElement.clientHeight;\n\n                if((scrollTop >= ((scrollHeight * this.buffer) - (viewportHeight)))) {\n                    this.load();\n                }\n            });\n        }\n        else {\n            this.scrollFunction = this.renderer.listenGlobal('window', 'scroll', () => {\n                let docBody = document.body;\n                let docElement = document.documentElement;\n                let scrollTop = (window.pageYOffset||document.documentElement.scrollTop);\n                let winHeight = docElement.clientHeight;\n                let docHeight = Math.max(docBody.scrollHeight, docBody.offsetHeight, winHeight, docElement.scrollHeight, docElement.offsetHeight);\n                            \n                if(scrollTop >= ((docHeight * this.buffer) - winHeight)) {\n                    this.load();\n                }\n            });\n        }\n        \n    }\n    \n    ngOnDestroy() {\n        //unbind\n        if(this.scrollFunction) {\n            this.scrollFunction();\n            this.contentElement = null;\n        }\n    }\n}\n\n@NgModule({\n    imports: [CommonModule,SharedModule],\n    exports: [DataScroller,SharedModule],\n    declarations: [DataScroller]\n})\nexport class DataScrollerModule { }\n\n"]}